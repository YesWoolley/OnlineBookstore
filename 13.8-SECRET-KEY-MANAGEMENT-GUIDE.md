# Section 13.8: Secret Key Management Guide

This section provides a comprehensive guide for creating and managing secret keys in the Ebooks Platform project.

---

## üéØ Secret Keys Overview

Secret keys are sensitive credentials used for authentication, encryption, and API access. This guide covers creating and managing them securely.

---

## üîë Types of Secret Keys in Your Project

### **‚úÖ 1. JWT Secret Key**
- **Purpose:** Signing JSON Web Tokens for authentication
- **Location:** `appsettings.json` ‚Üí `JwtSettings:SecretKey`
- **Usage:** User authentication and session management

### **‚úÖ 2. PayPal API Keys**
- **Purpose:** PayPal payment processing
- **Location:** `appsettings.json` ‚Üí `PayPal:ClientId` and `PayPal:ClientSecret`
- **Usage:** Payment transactions and PayPal integration

### **‚úÖ 3. Database Connection String**
- **Purpose:** Database connectivity
- **Location:** `appsettings.json` ‚Üí `ConnectionStrings:DefaultConnection`
- **Usage:** Entity Framework database access

---

## üéØ How to Create Secret Keys

### **‚úÖ 1. JWT Secret Key Generation**

#### **Method 1: Using .NET (Recommended)**
```bash
# Generate a secure JWT secret key
dotnet user-secrets set "JwtSettings:SecretKey" "YourSuperSecretKeyHere123!@#"
```

#### **Method 2: Using Online Generators**
```bash
# Use a secure random generator
# Visit: https://generate-secret.vercel.app/32
# Or use: https://www.allkeysgenerator.com/
```

#### **Method 3: Using PowerShell**
```powershell
# Generate a random 32-character string
$bytes = New-Object Byte[] 32
(New-Object Security.Cryptography.RNGCryptoServiceProvider).GetBytes($bytes)
[Convert]::ToBase64String($bytes)
```

### **‚úÖ 2. PayPal API Keys**

#### **Step 1: Create PayPal Developer Account**
1. Go to [PayPal Developer Dashboard](https://developer.paypal.com/)
2. Sign up for a developer account
3. Navigate to "My Apps & Credentials"

#### **Step 2: Create PayPal App**
1. Click "Create App"
2. Choose "Business" app type
3. Enter app name (e.g., "Ebooks Platform")
4. Click "Create App"

#### **Step 3: Get Sandbox Credentials**
```json
{
  "PayPal": {
    "ClientId": "YOUR_SANDBOX_CLIENT_ID",
    "ClientSecret": "YOUR_SANDBOX_CLIENT_SECRET",
    "Mode": "sandbox"
  }
}
```

#### **Step 4: Get Live Credentials (Production)**
1. Switch to "Live" environment
2. Create new app for production
3. Get live Client ID and Secret

### **‚úÖ 3. Database Connection String**

#### **Method 1: SQL Server LocalDB**
```json
{
  "ConnectionStrings": {
    "DefaultConnection": "Server=(localdb)\\mssqllocaldb;Database=OnlineBookstoreDb;Trusted_Connection=true;MultipleActiveResultSets=true"
  }
}
```

#### **Method 2: SQL Server Express**
```json
{
  "ConnectionStrings": {
    "DefaultConnection": "Server=DESKTOP-74BG02I\\SQLEXPRESS;Database=OnlineBookstoreDb;Trusted_Connection=true;MultipleActiveResultSets=true;TrustServerCertificate=true"
  }
}
```

#### **Method 3: Azure SQL Database**
```json
{
  "ConnectionStrings": {
    "DefaultConnection": "Server=your-server.database.windows.net;Database=OnlineBookstoreDb;User Id=your-username;Password=your-password;TrustServerCertificate=true"
  }
}
```

---

## üéØ Secure Key Management

### **‚úÖ 1. Development Environment**

#### **Use User Secrets (Recommended)**
```bash
# Set JWT secret
dotnet user-secrets set "JwtSettings:SecretKey" "YourSuperSecretKeyHere123!@#"

# Set PayPal sandbox keys
dotnet user-secrets set "PayPal:ClientId" "YOUR_SANDBOX_CLIENT_ID"
dotnet user-secrets set "PayPal:ClientSecret" "YOUR_SANDBOX_CLIENT_SECRET"

# Set database connection
dotnet user-secrets set "ConnectionStrings:DefaultConnection" "YOUR_CONNECTION_STRING"
```

#### **View User Secrets**
```bash
# List all secrets
dotnet user-secrets list

# Remove a secret
dotnet user-secrets remove "JwtSettings:SecretKey"
```

### **‚úÖ 2. Production Environment**

#### **Method 1: Environment Variables**
```bash
# Set environment variables
setx JWT_SECRET_KEY "YourProductionSecretKey"
setx PAYPAL_CLIENT_ID "YOUR_LIVE_CLIENT_ID"
setx PAYPAL_CLIENT_SECRET "YOUR_LIVE_CLIENT_SECRET"
```

#### **Method 2: Azure Key Vault**
```csharp
// In Program.cs
builder.Configuration.AddAzureKeyVault(
    new Uri($"https://{builder.Configuration["KeyVault:Vault"]}.vault.azure.net/"),
    new DefaultAzureCredential());
```

#### **Method 3: Docker Secrets**
```yaml
# docker-compose.yml
version: '3.8'
services:
  app:
    secrets:
      - jwt_secret
      - paypal_client_id
      - paypal_client_secret
secrets:
  jwt_secret:
    external: true
  paypal_client_id:
    external: true
  paypal_client_secret:
    external: true
```

---

## üéØ Key Generation Best Practices

### **‚úÖ 1. JWT Secret Key Requirements**
- **Length:** At least 32 characters
- **Complexity:** Mix of uppercase, lowercase, numbers, symbols
- **Uniqueness:** Never reuse across applications
- **Randomness:** Use cryptographically secure random generators

#### **Example JWT Secret:**
```
K8s#mN2$pQ9@vX7&jL4!hF6*wR3^tY1%cE5#nB8$mK2@vX7&jL4!hF6*wR3^tY1%cE5
```

### **‚úÖ 2. PayPal API Key Requirements**
- **Sandbox:** Use PayPal developer dashboard
- **Production:** Use PayPal business account
- **Security:** Never expose in client-side code
- **Rotation:** Regularly rotate production keys

### **‚úÖ 3. Database Connection Requirements**
- **Encryption:** Use encrypted connections
- **Authentication:** Use strong passwords
- **Network:** Restrict access to database server
- **Backup:** Secure backup of connection strings

---

## üéØ Security Best Practices

### **‚úÖ Do:**
- **Use User Secrets** for development
- **Use Environment Variables** for production
- **Rotate keys regularly** (especially production)
- **Use strong, random keys**
- **Limit key access** to necessary personnel
- **Monitor key usage** for suspicious activity

### **‚ùå Don't:**
- **Commit secrets to version control**
- **Use weak or predictable keys**
- **Share keys via email or chat**
- **Store keys in plain text files**
- **Use the same key across environments**
- **Forget to backup keys securely**

---

## üéØ Key Rotation Strategy

### **‚úÖ 1. JWT Secret Rotation**
```bash
# Generate new JWT secret
dotnet user-secrets set "JwtSettings:SecretKey" "NewSuperSecretKey456!@#"

# Update in production
setx JWT_SECRET_KEY "NewProductionSecretKey456!@#"
```

### **‚úÖ 2. PayPal Key Rotation**
1. **Generate new keys** in PayPal dashboard
2. **Update configuration** with new keys
3. **Test thoroughly** before switching
4. **Keep old keys** as backup temporarily

### **‚úÖ 3. Database Key Rotation**
1. **Create new database user**
2. **Update connection string**
3. **Test application** with new credentials
4. **Remove old user** after confirmation

---

## üéØ Emergency Key Recovery

### **‚úÖ 1. JWT Secret Recovery**
```bash
# Check current secret
dotnet user-secrets list

# If lost, generate new one
dotnet user-secrets set "JwtSettings:SecretKey" "NewEmergencySecretKey789!@#"
```

### **‚úÖ 2. PayPal Key Recovery**
1. **Log into PayPal Developer Dashboard**
2. **Navigate to "My Apps & Credentials"**
3. **View or regenerate keys**
4. **Update application configuration**

### **‚úÖ 3. Database Key Recovery**
1. **Contact database administrator**
2. **Reset database user password**
3. **Update connection string**
4. **Test application connectivity**

---

## üéØ Monitoring and Alerts

### **‚úÖ 1. Key Usage Monitoring**
```csharp
// Log key usage (without exposing keys)
_logger.LogInformation("JWT token generated for user {UserId}", userId);
_logger.LogInformation("PayPal payment initiated for order {OrderId}", orderId);
```

### **‚úÖ 2. Security Alerts**
- **Failed authentication attempts**
- **Unusual payment patterns**
- **Database connection failures**
- **Key rotation reminders**

---

## üéØ Troubleshooting

### **‚úÖ Common Issues:**

#### **1. JWT Token Validation Fails**
```bash
# Check JWT secret is set correctly
dotnet user-secrets list

# Verify secret in configuration
Console.WriteLine(builder.Configuration["JwtSettings:SecretKey"]);
```

#### **2. PayPal Authentication Fails**
```bash
# Verify PayPal keys
Console.WriteLine(builder.Configuration["PayPal:ClientId"]);
Console.WriteLine(builder.Configuration["PayPal:ClientSecret"]);
```

#### **3. Database Connection Fails**
```bash
# Test connection string
dotnet ef database update --connection "YOUR_CONNECTION_STRING"
```

---

## üéØ Summary

**Secret Key Management is Critical:**

‚úÖ **Generate strong keys** using secure methods  
‚úÖ **Use User Secrets** for development  
‚úÖ **Use Environment Variables** for production  
‚úÖ **Rotate keys regularly** for security  
‚úÖ **Monitor key usage** for anomalies  
‚úÖ **Backup keys securely** for recovery  

**Your application's security depends on proper key management!** üöÄ

---

**üéØ Key Takeaway:** Proper secret key management ensures your ebooks platform remains secure and reliable! ‚úÖ 